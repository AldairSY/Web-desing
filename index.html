<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Investigación e Innovación - UPLA</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="logo-container">
                <img src="logo-upla.png" alt="UPLA Logo" class="logo">
                <h1>Sistema de Investigación e Innovación</h1>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="email">Correo Institucional</label>
                    <input type="email" id="email" placeholder="usuario@upla.edu.pe" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" placeholder="Ingrese su contraseña" required>
                </div>
                <button type="submit" class="btn-primary">Iniciar Sesión</button>
                <div id="loginError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- DASHBOARD PRINCIPAL -->
    <div id="dashboardPage" class="page">
        <nav class="navbar">
            <div class="nav-brand">
                <img src="logo-upla.png" alt="UPLA" class="nav-logo">
                <h2>Investigación e Innovación</h2>
            </div>
            <div class="nav-user">
                <span id="userName"></span>
                <button onclick="logout()" class="btn-secondary">Cerrar Sesión</button>
            </div>
        </nav>

        <div class="dashboard-container">
            <h1 class="page-title">Categorías de Innovación</h1>
            <div class="categories-grid">
                <div class="category-card" onclick="openCategory('tecnologica')">
                    <div class="category-icon">💻</div>
                    <h3>Innovación Tecnológica</h3>
                    <p>Proyectos de desarrollo tecnológico y software</p>
                    <button class="btn-category">Ver Proyectos</button>
                </div>
                <div class="category-card" onclick="openCategory('aplicada')">
                    <div class="category-icon">🔬</div>
                    <h3>Innovación Aplicada</h3>
                    <p>Proyectos de investigación aplicada</p>
                    <button class="btn-category">Ver Proyectos</button>
                </div>
                <div class="category-card" onclick="openCategory('pedagogica')">
                    <div class="category-icon">📚</div>
                    <h3>Innovación Pedagógica</h3>
                    <p>Proyectos de mejora educativa</p>
                    <button class="btn-category">Ver Proyectos</button>
                </div>
            </div>
        </div>
    </div>
    <!-- PÁGINA DE CATEGORÍA CON FILTROS -->
<div id="categoryPage" class="page">
    <nav class="navbar">
        <div class="nav-brand">
            <img src="logo-upla.png" alt="UPLA" class="nav-logo">
            <h2>Investigación e Innovación</h2>
        </div>
        <div class="nav-user">
            <button onclick="showDashboard()" class="btn-secondary">Volver</button>
            <button onclick="logout()" class="btn-secondary">Cerrar Sesión</button>
        </div>
    </nav>

    <div class="category-container">
        <div class="category-header">
            <h1 id="categoryTitle"></h1>
            <button onclick="showNewProjectForm()" class="btn-primary">+ Agregar Nuevo Proyecto</button>
        </div>

        <!-- FILTROS DE BÚSQUEDA -->
        <div class="filters-container">
            <div class="filters-title">
                <h3>🔍 Filtrar Proyectos</h3>
                <button onclick="clearFilters()" class="btn-clear">Limpiar Filtros</button>
            </div>
            <div class="filters-grid">
                <div class="filter-item">
                    <label>Buscar por nombre</label>
                    <input type="text" id="filterName" placeholder="Nombre del proyecto..." oninput="applyFilters()">
                </div>
                <div class="filter-item">
                    <label>Tipo de proyecto</label>
                    <select id="filterType" onchange="applyFilters()">
                        <option value="">Todos</option>
                        <option value="basica">Investigación Básica</option>
                        <option value="aplicada">Investigación Aplicada</option>
                        <option value="desarrollo">Desarrollo Tecnológico</option>
                        <option value="innovacion">Innovación</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>Investigador</label>
                    <input type="text" id="filterResearcher" placeholder="Nombre del investigador..." oninput="applyFilters()">
                </div>
                <div class="filter-item">
                    <label>Programa</label>
                    <input type="text" id="filterProgram" placeholder="Programa de estudio..." oninput="applyFilters()">
                </div>
            </div>
            <div class="filter-results">
                <span id="filterCount">0 proyectos encontrados</span>
            </div>
        </div>

        <div id="projectsList" class="projects-list"></div>
    </div>
</div>


    <!-- FORMULARIO NUEVO PROYECTO -->
    <div id="newProjectPage" class="page">
        <nav class="navbar">
            <div class="nav-brand">
                <img src="logo-upla.png" alt="UPLA" class="nav-logo">
                <h2>Nuevo Proyecto</h2>
            </div>
            <div class="nav-user">
                <button onclick="backToCategory()" class="btn-secondary">Volver</button>
            </div>
        </nav>

        <div class="form-container">
            <h1>Agregar Nuevo Proyecto de Innovación</h1>
            <form id="newProjectForm" class="project-form">
                <div class="form-group">
                    <label for="projectName">Nombre del Proyecto *</label>
                    <input type="text" id="projectName" required>
                </div>

                <div class="form-group">
                    <label for="projectType">Tipo de Proyecto *</label>
                    <select id="projectType" required>
                        <option value="">Seleccione...</option>
                        <option value="basica">Investigación Básica</option>
                        <option value="aplicada">Investigación Aplicada</option>
                        <option value="desarrollo">Desarrollo Tecnológico</option>
                        <option value="innovacion">Innovación</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="researchers">Investigadores *</label>
                    <textarea id="researchers" rows="3" placeholder="Nombre completo de los investigadores (separados por coma)" required></textarea>
                </div>

                <div class="form-group">
                    <label for="studyProgram">Programa de Estudio *</label>
                    <input type="text" id="studyProgram" placeholder="Ej: Ingeniería de Sistemas" required>
                </div>

                <div class="form-group">
                    <label for="researchLine">Línea de Investigación *</label>
                    <input type="text" id="researchLine" required>
                </div>

                <div class="form-group">
                    <label for="contactEmail">Correo de Contacto *</label>
                    <input type="email" id="contactEmail" placeholder="correo@upla.edu.pe" required>
                </div>

                <div class="form-group">
                    <label for="generalInfo">Información General del Proyecto *</label>
                    <textarea id="generalInfo" rows="5" placeholder="Descripción general del proyecto" required></textarea>
                </div>

                <div class="form-group">
                    <label for="problemDescription">Identificación de la Problemática *</label>
                    <textarea id="problemDescription" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="theoreticalFramework">Marco Teórico *</label>
                    <textarea id="theoreticalFramework" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="projectSummary">Resumen del Proyecto *</label>
                    <textarea id="projectSummary" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label for="projectFile">Documento del Proyecto (PDF)</label>
                    <div class="file-upload-area">
                        <input type="file" id="projectFile" accept=".pdf" class="file-input">
                        <div class="file-upload-label">
                            <span class="file-icon">📄</span>
                            <span id="fileName">Selecciona un archivo PDF o arrastra aquí</span>
                        </div>
                    </div>
                    <small style="color: #666;">Opcional: Adjunta el documento completo del proyecto en formato PDF</small>
                </div>

                <div id="uploadProgress" style="display: none;" class="upload-progress">
                    <div class="progress-bar">
                        <div id="progressBarFill" class="progress-fill"></div>
                    </div>
                    <span id="progressText">Subiendo archivo...</span>
                </div>

                <button type="submit" class="btn-primary" id="submitBtn">Guardar Proyecto</button>
            </form>
        </div>
    </div>

    <!-- PÁGINA DE EVALUACIÓN -->
    <div id="evaluationPage" class="page">
        <nav class="navbar">
            <div class="nav-brand">
                <img src="logo-upla.png" alt="UPLA" class="nav-logo">
                <h2>Evaluación de Proyecto</h2>
            </div>
            <div class="nav-user">
                <button onclick="backToCategory()" class="btn-secondary">Volver</button>
            </div>
        </nav>

        <div class="evaluation-container">
            <div class="eval-header">
                <h1 id="evalProjectTitle"></h1>
                <div class="total-score-badge">
                    <span>Puntuación Total</span>
                    <div class="score-display" id="totalScoreDisplay">0</div>
                    <span class="score-max">/ 100 puntos</span>
                </div>
            </div>
            
            <div class="project-info-card">
                <h3>📋 Información del Proyecto</h3>
                <div id="projectInfoDisplay"></div>
            </div>

            <div class="evaluation-form-container">
                <h2>Sistema de Evaluación de Proyectos de Innovación</h2>
                <p class="eval-subtitle">Complete todas las secciones con sus respectivas calificaciones y observaciones</p>
                
                <form id="evaluationForm" class="evaluation-form">
                    
                    <!-- SECCIÓN 1 -->
                    <div class="eval-section">
                        <div class="section-header">
                            <h3>1️⃣ Datos Generales y Presentación</h3>
                            <span class="section-points">(0-15 puntos)</span>
                        </div>
                        
                        <div class="eval-criteria">
                            <div class="criteria-item">
                                <label>1.1 Título del proyecto</label>
                                <p class="criteria-desc">Claridad, precisión y relevancia del título</p>
                                <input type="number" id="eval1_1" min="0" max="3" step="0.5" required>
                                <span class="max-points">/ 3 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>1.2 Datos de los investigadores</label>
                                <p class="criteria-desc">Completitud y pertinencia de la información</p>
                                <input type="number" id="eval1_2" min="0" max="3" step="0.5" required>
                                <span class="max-points">/ 3 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>1.3 Línea de investigación</label>
                                <p class="criteria-desc">Coherencia con el programa y área de estudio</p>
                                <input type="number" id="eval1_3" min="0" max="3" step="0.5" required>
                                <span class="max-points">/ 3 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>1.4 Presentación y formato</label>
                                <p class="criteria-desc">Organización, ortografía y estructura del documento</p>
                                <input type="number" id="eval1_4" min="0" max="3" step="0.5" required>
                                <span class="max-points">/ 3 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>1.5 Documentación adjunta</label>
                                <p class="criteria-desc">Calidad y completitud de archivos complementarios</p>
                                <input type="number" id="eval1_5" min="0" max="3" step="0.5" required>
                                <span class="max-points">/ 3 pts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Observaciones Generales</label>
                            <textarea id="obs1" rows="3" placeholder="Comentarios sobre datos generales y presentación..."></textarea>
                        </div>
                        <div class="section-total">Subtotal Sección 1: <span id="subtotal1">0</span> / 15</div>
                    </div>

                    <!-- SECCIÓN 2 -->
                    <div class="eval-section">
                        <div class="section-header">
                            <h3>2️⃣ Resumen Ejecutivo</h3>
                            <span class="section-points">(0-15 puntos)</span>
                        </div>
                        
                        <div class="eval-criteria">
                            <div class="criteria-item">
                                <label>2.1 Claridad del resumen</label>
                                <p class="criteria-desc">Síntesis clara y comprensible del proyecto</p>
                                <input type="number" id="eval2_1" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>2.2 Objetivos del proyecto</label>
                                <p class="criteria-desc">Definición precisa de objetivos generales y específicos</p>
                                <input type="number" id="eval2_2" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>2.3 Alcance del proyecto</label>
                                <p class="criteria-desc">Delimitación clara del alcance y limitaciones</p>
                                <input type="number" id="eval2_3" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Observaciones sobre el Resumen</label>
                            <textarea id="obs2" rows="3" placeholder="Comentarios sobre el resumen ejecutivo..."></textarea>
                        </div>
                        <div class="section-total">Subtotal Sección 2: <span id="subtotal2">0</span> / 15</div>
                    </div>

                    <!-- SECCIÓN 3 -->
                    <div class="eval-section">
                        <div class="section-header">
                            <h3>3️⃣ Identificación de la Problemática</h3>
                            <span class="section-points">(0-20 puntos)</span>
                        </div>
                        
                        <div class="eval-criteria">
                            <div class="criteria-item">
                                <label>3.1 Planteamiento del problema</label>
                                <p class="criteria-desc">Claridad en la definición y contextualización del problema</p>
                                <input type="number" id="eval3_1" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>3.2 Justificación</label>
                                <p class="criteria-desc">Relevancia e importancia del problema a resolver</p>
                                <input type="number" id="eval3_2" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>3.3 Análisis de causas</label>
                                <p class="criteria-desc">Identificación de factores y variables del problema</p>
                                <input type="number" id="eval3_3" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>3.4 Impacto esperado</label>
                                <p class="criteria-desc">Beneficios y alcance de la solución propuesta</p>
                                <input type="number" id="eval3_4" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Observaciones sobre la Problemática</label>
                            <textarea id="obs3" rows="3" placeholder="Comentarios sobre la identificación del problema..."></textarea>
                        </div>
                        <div class="section-total">Subtotal Sección 3: <span id="subtotal3">0</span> / 20</div>
                    </div>

                    <!-- SECCIÓN 4 -->
                    <div class="eval-section">
                        <div class="section-header">
                            <h3>4️⃣ Marco Teórico y Conceptual</h3>
                            <span class="section-points">(0-20 puntos)</span>
                        </div>
                        
                        <div class="eval-criteria">
                            <div class="criteria-item">
                                <label>4.1 Antecedentes</label>
                                <p class="criteria-desc">Revisión de investigaciones y proyectos previos</p>
                                <input type="number" id="eval4_1" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>4.2 Bases teóricas</label>
                                <p class="criteria-desc">Fundamentos teóricos y conceptuales sólidos</p>
                                <input type="number" id="eval4_2" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>4.3 Estado del arte</label>
                                <p class="criteria-desc">Conocimiento actual sobre el tema de investigación</p>
                                <input type="number" id="eval4_3" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>4.4 Referencias bibliográficas</label>
                                <p class="criteria-desc">Calidad, actualidad y pertinencia de las fuentes</p>
                                <input type="number" id="eval4_4" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Observaciones sobre el Marco Teórico</label>
                            <textarea id="obs4" rows="3" placeholder="Comentarios sobre el marco teórico y conceptual..."></textarea>
                        </div>
                        <div class="section-total">Subtotal Sección 4: <span id="subtotal4">0</span> / 20</div>
                    </div>

                    <!-- SECCIÓN 5 -->
                    <div class="eval-section">
                        <div class="section-header">
                            <h3>5️⃣ Metodología y Desarrollo</h3>
                            <span class="section-points">(0-20 puntos)</span>
                        </div>
                        
                        <div class="eval-criteria">
                            <div class="criteria-item">
                                <label>5.1 Diseño metodológico</label>
                                <p class="criteria-desc">Coherencia y adecuación de la metodología propuesta</p>
                                <input type="number" id="eval5_1" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>5.2 Técnicas e instrumentos</label>
                                <p class="criteria-desc">Selección apropiada de herramientas y técnicas</p>
                                <input type="number" id="eval5_2" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>5.3 Plan de trabajo</label>
                                <p class="criteria-desc">Cronograma y actividades bien definidas</p>
                                <input type="number" id="eval5_3" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>5.4 Viabilidad</label>
                                <p class="criteria-desc">Factibilidad técnica, económica y temporal</p>
                                <input type="number" id="eval5_4" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Observaciones sobre la Metodología</label>
                            <textarea id="obs5" rows="3" placeholder="Comentarios sobre metodología y plan de desarrollo..."></textarea>
                        </div>
                        <div class="section-total">Subtotal Sección 5: <span id="subtotal5">0</span> / 20</div>
                    </div>

                    <!-- SECCIÓN 6 -->
                    <div class="eval-section">
                        <div class="section-header">
                            <h3>6️⃣ Innovación y Originalidad</h3>
                            <span class="section-points">(0-10 puntos)</span>
                        </div>
                        
                        <div class="eval-criteria">
                            <div class="criteria-item">
                                <label>6.1 Grado de innovación</label>
                                <p class="criteria-desc">Aporte novedoso y diferenciador del proyecto</p>
                                <input type="number" id="eval6_1" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                            
                            <div class="criteria-item">
                                <label>6.2 Originalidad</label>
                                <p class="criteria-desc">Creatividad y enfoque único de la propuesta</p>
                                <input type="number" id="eval6_2" min="0" max="5" step="0.5" required>
                                <span class="max-points">/ 5 pts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Observaciones sobre Innovación</label>
                            <textarea id="obs6" rows="3" placeholder="Comentarios sobre el carácter innovador del proyecto..."></textarea>
                        </div>
                        <div class="section-total">Subtotal Sección 6: <span id="subtotal6">0</span> / 10</div>
                    </div>

                    <!-- CALIFICACIÓN FINAL -->
                    <div class="final-score-section">
                        <h3>📊 Calificación Final</h3>
                        <div class="score-breakdown">
                            <div class="score-row">
                                <span>Datos Generales y Presentación:</span>
                                <span class="score-value" id="final1">0</span>
                            </div>
                            <div class="score-row">
                                <span>Resumen Ejecutivo:</span>
                                <span class="score-value" id="final2">0</span>
                            </div>
                            <div class="score-row">
                                <span>Identificación de la Problemática:</span>
                                <span class="score-value" id="final3">0</span>
                            </div>
                            <div class="score-row">
                                <span>Marco Teórico y Conceptual:</span>
                                <span class="score-value" id="final4">0</span>
                            </div>
                            <div class="score-row">
                                <span>Metodología y Desarrollo:</span>
                                <span class="score-value" id="final5">0</span>
                            </div>
                            <div class="score-row">
                                <span>Innovación y Originalidad:</span>
                                <span class="score-value" id="final6">0</span>
                            </div>
                            <div class="score-row total-row">
                                <span>CALIFICACIÓN TOTAL:</span>
                                <span class="score-value-final" id="finalTotal">0 / 100</span>
                            </div>
                        </div>
                        
                        <div class="evaluation-status" id="evaluationStatus"></div>
                    </div>

                    <div class="form-group">
                        <label>Recomendaciones Finales</label>
                        <textarea id="finalRecommendations" rows="4" placeholder="Sugerencias y recomendaciones generales para el proyecto..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">💾 Guardar Evaluación</button>
                        <button type="button" onclick="exportPDF()" class="btn-export">📄 Exportar a PDF</button>
                        <button type="button" onclick="downloadLocal()" class="btn-export">💾 Descargar JSON</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="supabaseClient.js"></script>
    <script src="app.js"></script>
</body>
</html>
